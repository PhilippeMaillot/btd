<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Choix de la carte</title>
  <link rel="stylesheet" href="./style/select-map.css" />
  <style>
    .delete-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      background-color: #ffebeb;
      border: 2px solid #ff7c7c;
      border-radius: 8px;
      color: #a00000;
      font-weight: bold;
      cursor: pointer;
      padding: 4px 8px;
      font-size: 12px;
      transition: background-color 0.2s ease;
    }

    .delete-btn:hover {
      background-color: #ffc0c0;
    }
  </style>
</head>

<body>
  <div class="header">
    <h1>üó∫Ô∏è Choisis ta carte</h1>
    <a href="map-editor.html" class="editor-button">+ Cr√©er une nouvelle</a>
  </div>

  <div class="map-container" id="mapContainer"></div>

  <script type="module">
    import { allPaths } from './src/config/path.js';

    const container = document.getElementById('mapContainer');

    // Cr√©e une carte avec √©ventuel bouton de suppression
    function createMapCanvas(key, path, isCustom = false) {
      const canvas = document.createElement('canvas');
      canvas.width = 325;
      canvas.height = 225;
      const ctx = canvas.getContext('2d');

      ctx.strokeStyle = "#405b3c";
      ctx.lineWidth = 5;
      ctx.lineJoin = "round";
      ctx.beginPath();
      ctx.moveTo(path[0].x / 3.3, path[0].y / 3.3);
      for (let point of path.slice(1)) {
        ctx.lineTo(point.x / 3.3, point.y / 3.3);
      }
      ctx.stroke();

      const wrapper = document.createElement('div');
      wrapper.classList.add('map-preview');
      wrapper.title = key;

      wrapper.appendChild(canvas);

      if (isCustom) {
        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'delete-btn';
        deleteBtn.textContent = 'üóëÔ∏è';
        deleteBtn.onclick = (e) => {
          e.stopPropagation(); // Emp√™che le click sur la carte
          if (confirm(`Supprimer la carte "${key}" ?`)) {
            const customMaps = JSON.parse(localStorage.getItem("customMaps") || "{}");
            delete customMaps[key];
            localStorage.setItem("customMaps", JSON.stringify(customMaps));
            location.reload();
          }
        };
        wrapper.appendChild(deleteBtn);
      }

      wrapper.onclick = () => {
        localStorage.setItem('selectedMap', key);
        localStorage.setItem('selectedMapIsCustom', isCustom);
        window.location.href = 'index.html';
      };

      container.appendChild(wrapper);
    }

    // Maps par d√©faut
    Object.entries(allPaths).forEach(([key, path]) => {
      createMapCanvas(key, path, false);
    });

    // Maps custom
    const customMaps = JSON.parse(localStorage.getItem("customMaps") || "{}");
    Object.entries(customMaps).forEach(([key, path]) => {
      if (Array.isArray(path) && path.length > 0 && path[0].x !== undefined) {
        createMapCanvas(key, path, true);
      }
    });
  </script>
</body>
</html>
